"use strict";(()=>{var Fr=Object.create;var Tt=Object.defineProperty;var Or=Object.getOwnPropertyDescriptor;var Mr=Object.getOwnPropertyNames;var Gr=Object.getPrototypeOf,qr=Object.prototype.hasOwnProperty;var h=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var Br=(e,r,n,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of Mr(r))!qr.call(e,o)&&o!==n&&Tt(e,o,{get:()=>r[o],enumerable:!(i=Or(r,o))||i.enumerable});return e};var J=(e,r,n)=>(n=e!=null?Fr(Gr(e)):{},Br(r||!e||!e.__esModule?Tt(n,"default",{value:e,enumerable:!0}):n,e));var Ne=h(k=>{"use strict";var yt=k&&k.__extends||function(){var e=function(r,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var s in o)o.hasOwnProperty(s)&&(i[s]=o[s])},e(r,n)};return function(r,n){e(r,n);function i(){this.constructor=r}r.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(k,"__esModule",{value:!0});k.buildLexer=k.extractByTokenRange=k.extractByPositionRange=k.TokenRangeError=k.TokenError=void 0;function Ce(e){return e===void 0?"<END-OF-FILE>":JSON.stringify(e)}var gt=function(e){yt(r,e);function r(n,i){var o=e.call(this,Ce(n)+": "+i)||this;return o.pos=n,o.errorMessage=i,o}return r}(Error);k.TokenError=gt;var Wr=function(e){yt(r,e);function r(n,i,o){var s=e.call(this,Ce(n)+" - "+Ce(i)+": "+o)||this;return s.first=n,s.next=i,s.errorMessage=o,s}return r}(Error);k.TokenRangeError=Wr;function St(e,r,n){var i=r===void 0?e.length:r.index,o=n===void 0?e.length:n.index;return i>=o?"":e.substring(i,o)}k.extractByPositionRange=St;function Vr(e,r,n){return St(e,r===void 0?void 0:r.pos,n===void 0?void 0:n.pos)}k.extractByTokenRange=Vr;var Hr=function(){function e(r,n,i,o,s,p){this.lexer=r,this.input=n,this.kind=i,this.text=o,this.pos=s,this.keep=p}return Object.defineProperty(e.prototype,"next",{get:function(){return this.nextToken===void 0&&(this.nextToken=this.lexer.parseNextAvailable(this.input,this.pos.index+this.text.length,this.pos.rowEnd,this.pos.columnEnd),this.nextToken===void 0&&(this.nextToken=null)),this.nextToken===null?void 0:this.nextToken},enumerable:!1,configurable:!0}),e}(),Xr=function(){function e(r){this.rules=r;for(var n=0,i=this.rules;n<i.length;n++){var o=i[n];if(o[1].source[0]!=="^")throw new Error('Regular expression patterns for a tokenizer should start with "^": '+o[1].source);if(!o[1].global)throw new Error("Regular expression patterns for a tokenizer should be global: "+o[1].source)}}return e.prototype.parse=function(r){return this.parseNextAvailable(r,0,1,1)},e.prototype.parseNext=function(r,n,i,o){if(n!==r.length){for(var s=r.substr(n),p,c=0,f=this.rules;c<f.length;c++){var l=f[c],E=l[0],g=l[1],A=l[2];if(g.lastIndex=0,g.test(s)){for(var v=s.substr(0,g.lastIndex),C=i,w=o,Q=0,$=v;Q<$.length;Q++){var Ur=$[Q];switch(Ur){case"\r":break;case`
`:C++,w=1;break;default:w++}}var mt=new Hr(this,r,A,v,{index:n,rowBegin:i,columnBegin:o,rowEnd:C,columnEnd:w},E);(p===void 0||p.text.length<mt.text.length)&&(p=mt)}}if(p===void 0)throw new gt({index:n,rowBegin:i,columnBegin:o,rowEnd:i,columnEnd:o},"Unable to tokenize the rest of the input: "+r.substr(n));return p}},e.prototype.parseNextAvailable=function(r,n,i,o){for(var s;;){if(s=this.parseNext(r,s===void 0?n:s.pos.index+s.text.length,s===void 0?i:s.pos.rowEnd,s===void 0?o:s.pos.columnEnd),s===void 0)return;if(s.keep)return s}},e}();function Yr(e){return new Xr(e)}k.buildLexer=Yr});var F=h(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.unableToConsumeToken=M.resultOrError=M.betterError=void 0;function $r(e,r){return e===void 0?r:r===void 0||e.pos===void 0?e:r.pos===void 0||e.pos.index<r.pos.index?r:(e.pos.index>r.pos.index,e)}M.betterError=$r;function Jr(e,r,n){return n?{candidates:e,successful:!0,error:r}:{successful:!1,error:r}}M.resultOrError=Jr;function Zr(e){return{kind:"Error",pos:e===void 0?void 0:e.pos,message:"Unable to consume token: "+(e===void 0?"<END-OF-FILE>":e.text)}}M.unableToConsumeToken=Zr});var se=h(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.tok=K.str=K.fail=K.succ=K.nil=void 0;var Et=F();function en(){return{parse:function(e){return{candidates:[{firstToken:e,nextToken:e,result:void 0}],successful:!0,error:void 0}}}}K.nil=en;function tn(e){return{parse:function(r){return{candidates:[{firstToken:r,nextToken:r,result:e}],successful:!0,error:void 0}}}}K.succ=tn;function rn(e){return{parse:function(r){return{successful:!1,error:{kind:"Error",pos:r?.pos,message:e}}}}}K.fail=rn;function nn(e){return{parse:function(r){return r===void 0||r.text!==e?{successful:!1,error:Et.unableToConsumeToken(r)}:{candidates:[{firstToken:r,nextToken:r.next,result:r}],successful:!0,error:void 0}}}}K.str=nn;function on(e){return{parse:function(r){return r===void 0||r.kind!==e?{successful:!1,error:Et.unableToConsumeToken(r)}:{candidates:[{firstToken:r,nextToken:r.next,result:r}],successful:!0,error:void 0}}}}K.tok=on});var vt=h(ae=>{"use strict";Object.defineProperty(ae,"__esModule",{value:!0});ae.combine=void 0;var _t=F();function sn(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return{parse:function(i){var o=e.parse(i);if(!o.successful)return o;for(var s=o.candidates,p=o.error,c=0,f=r;c<f.length;c++){var l=f[c];if(s.length===0)break;var E=s;s=[];for(var g=0,A=E;g<A.length;g++){var v=A[g],C=l(v.result).parse(v.nextToken);if(p=_t.betterError(p,C.error),C.successful)for(var w=0,Q=C.candidates;w<Q.length;w++){var $=Q[w];s.push({firstToken:v.firstToken,nextToken:$.nextToken,result:$.result})}}}return _t.resultOrError(s,p,s.length!==0)}}}ae.combine=sn});var pe=h(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.seq=void 0;var ht=F();function an(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return{parse:function(n){for(var i,o=[{firstToken:n,nextToken:n,result:[]}],s=0,p=e;s<p.length;s++){var c=p[s];if(o.length===0)break;var f=o;o=[];for(var l=0,E=f;l<E.length;l++){var g=E[l],A=c.parse(g.nextToken);if(i=ht.betterError(i,A.error),A.successful)for(var v=0,C=A.candidates;v<C.length;v++){var w=C[v];o.push({firstToken:g.firstToken,nextToken:w.nextToken,result:g.result.concat([w.result])})}}}return ht.resultOrError(o,i,o.length!==0)}}}ue.seq=an});var Re=h(ce=>{"use strict";Object.defineProperty(ce,"__esModule",{value:!0});ce.alt=void 0;var Pt=F();function un(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return{parse:function(n){for(var i,o=[],s=!1,p=0,c=e;p<c.length;p++){var f=c[p],l=f.parse(n);i=Pt.betterError(i,l.error),l.successful&&(o=o.concat(l.candidates),s=!0)}return Pt.resultOrError(o,i,s)}}}ce.alt=un});var bt=h(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.alt_sc=void 0;var kt=F();function pn(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return{parse:function(n){for(var i,o=0,s=e;o<s.length;o++){var p=s[o],c=p.parse(n);if(i=kt.betterError(i,c.error),c.successful)return kt.resultOrError(c.candidates,i,!0)}return{successful:!1,error:i}}}}de.alt_sc=pn});var At=h(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});z.opt_sc=z.opt=void 0;var cn=Re(),dn=se();function ln(e){return cn.alt(e,dn.nil())}z.opt=ln;function fn(e){return{parse:function(r){var n=e.parse(r);return n.successful?n:{candidates:[{firstToken:r,nextToken:r,result:void 0}],successful:!0,error:n.error}}}}z.opt_sc=fn});var Ke=h(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.kmid=U.kright=U.kleft=U.apply=void 0;var Ie=pe();function le(e,r){return{parse:function(n){var i=e.parse(n);return i.successful?{candidates:i.candidates.map(function(o){return{firstToken:n,nextToken:o.nextToken,result:r(o.result,[n,o.nextToken])}}),successful:!0,error:i.error}:i}}}U.apply=le;function mn(e,r){return le(Ie.seq(e,r),function(n){return n[0]})}U.kleft=mn;function Tn(e,r){return le(Ie.seq(e,r),function(n){return n[1]})}U.kright=Tn;function xn(e,r,n){return le(Ie.seq(e,r,n),function(i){return i[1]})}U.kmid=xn});var It=h(x=>{"use strict";var yn=x&&x.__spreadArrays||function(){for(var e=0,r=0,n=arguments.length;r<n;r++)e+=arguments[r].length;for(var i=Array(e),o=0,r=0;r<n;r++)for(var s=arguments[r],p=0,c=s.length;p<c;p++,o++)i[o]=s[p];return i};Object.defineProperty(x,"__esModule",{value:!0});x.lrec_sc=x.lrec=x.list_n=x.list_sc=x.list=x.rep_n=x.repr=x.rep_sc=x.rep=void 0;var O=Ke(),j=F(),Z=pe(),gn=se();function Le(e){var r=Ct(e);return{parse:function(n){var i=r.parse(n);return i.successful?{candidates:i.candidates.reverse(),successful:!0,error:i.error}:i}}}x.rep=Le;function De(e){return{parse:function(r){for(var n,i=[{firstToken:r,nextToken:r,result:[]}];;){var o=i;i=[];for(var s=0,p=o;s<p.length;s++){var c=p[s],f=e.parse(c.nextToken);if(n=j.betterError(n,f.error),f.successful)for(var l=0,E=f.candidates;l<E.length;l++){var g=E[l];g.nextToken!==c.nextToken&&i.push({firstToken:c.firstToken,nextToken:g.nextToken,result:c.result.concat([g.result])})}}if(i.length===0){i=o;break}}return j.resultOrError(i,n,!0)}}}x.rep_sc=De;function Ct(e){return{parse:function(r){for(var n,i=[{firstToken:r,nextToken:r,result:[]}],o=0;o<i.length;o++){var s=i[o],p=e.parse(s.nextToken);if(n=j.betterError(n,p.error),p.successful)for(var c=0,f=p.candidates;c<f.length;c++){var l=f[c];l.nextToken!==s.nextToken&&i.push({firstToken:s.firstToken,nextToken:l.nextToken,result:s.result.concat([l.result])})}}return j.resultOrError(i,n,!0)}}}x.repr=Ct;function Nt(e,r){return{parse:function(n){for(var i,o=[{firstToken:n,nextToken:n,result:[]}],s=0;s<r;s++){for(var p=[],c=0,f=o;c<f.length;c++){var l=f[c],E=e.parse(l.nextToken);if(i=j.betterError(i,E.error),E.successful)for(var g=0,A=E.candidates;g<A.length;g++){var v=A[g];p.push({firstToken:l.firstToken,nextToken:v.nextToken,result:l.result.concat([v.result])})}}if(p.length===0)return{successful:!1,error:i};o=p}return j.resultOrError(o,i,!0)}}}x.rep_n=Nt;function we(e){var r=e[0],n=e[1];return yn([r],n)}function Sn(e,r){return O.apply(Z.seq(e,Le(O.kright(r,e))),we)}x.list=Sn;function En(e,r){return O.apply(Z.seq(e,De(O.kright(r,e))),we)}x.list_sc=En;function _n(e,r,n){return n<1?gn.succ([]):n===1?O.apply(e,function(i){return[i]}):O.apply(Z.seq(e,Nt(O.kright(r,e),n-1)),we)}x.list_n=_n;function Rt(e){return function(r){for(var n=r[0],i=0,o=r[1];i<o.length;i++){var s=o[i];n=e(n,s)}return n}}function vn(e,r,n){return O.apply(Z.seq(e,Le(r)),Rt(n))}x.lrec=vn;function hn(e,r,n){return O.apply(Z.seq(e,De(r)),Rt(n))}x.lrec_sc=hn});var Kt=h(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.amb=void 0;function Pn(e){return{parse:function(r){var n=e.parse(r);if(!n.successful)return n;for(var i=new Map,o=0,s=n.candidates;o<s.length;o++){var p=s[o],c=i.get(p.nextToken);c===void 0?i.set(p.nextToken,[p]):c.push(p)}return{candidates:Array.from(i.values()).map(function(f){return{firstToken:f[0].firstToken,nextToken:f[0].nextToken,result:f.map(function(l){return l.result})}}),successful:!0,error:n.error}}}}fe.amb=Pn});var Lt=h(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.errd=W.err=void 0;function kn(e,r){return{parse:function(n){var i=e.parse(n);return i.successful?i:{successful:!1,error:{kind:"Error",pos:i.error.pos,message:r}}}}}W.err=kn;function bn(e,r,n){return{parse:function(i){var o=e.parse(i);return o.successful?o:{successful:!0,candidates:[{firstToken:i,nextToken:i,result:n}],error:{kind:"Error",pos:o.error.pos,message:r}}}}}W.errd=bn});var wt=h(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.expectSingleResult=G.expectEOF=G.rule=void 0;var Ue=Ne(),Dt=F(),An=function(){function e(){}return e.prototype.setPattern=function(r){this.parser=r},e.prototype.parse=function(r){if(this.parser===void 0)throw new Error("Rule has not been initialized. setPattern is required before calling parse.");return this.parser.parse(r)},e}();function Cn(){return new An}G.rule=Cn;function Nn(e){if(!e.successful)return e;if(e.candidates.length===0)return{successful:!1,error:{kind:"Error",pos:void 0,message:"No result is returned."}};for(var r=[],n=e.error,i=0,o=e.candidates;i<o.length;i++){var s=o[i];s.nextToken===void 0?r.push(s):n=Dt.betterError(n,{kind:"Error",pos:s.nextToken===void 0?void 0:s.nextToken.pos,message:'The parser cannot reach the end of file, stops at "'+s.nextToken.text+'" at position '+JSON.stringify(s.nextToken.pos)+"."})}return Dt.resultOrError(r,n,r.length!==0)}G.expectEOF=Nn;function Rn(e){if(!e.successful)throw new Ue.TokenError(e.error.pos,e.error.message);if(e.candidates.length===0)throw new Ue.TokenError(void 0,"No result is returned.");if(e.candidates.length!==1)throw new Ue.TokenError(void 0,"Multiple results are returned.");return e.candidates[0].result}G.expectSingleResult=Rn});var Ft=h(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.makeParserModule=V.lazy=void 0;function Ut(e){return{parse:function(r){return e().parse(r)}}}V.lazy=Ut;var In=function(e,r,n){return Object.defineProperty(e,r,{configurable:!0,writable:!1,enumerable:!0,value:n})};function Kn(e){for(var r=Object.create(null),n=function(f,l){r=In(r,f,Ut(function(){return l(r)}))},i=0,o=Object.entries(e);i<o.length;i++){var s=o[i],p=s[0],c=s[1];n(p,c)}return r}V.makeParserModule=Kn});var H=h(S=>{"use strict";var Ln=S&&S.__createBinding||(Object.create?function(e,r,n,i){i===void 0&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return r[n]}})}:function(e,r,n,i){i===void 0&&(i=n),e[i]=r[n]}),b=S&&S.__exportStar||function(e,r){for(var n in e)n!=="default"&&!r.hasOwnProperty(n)&&Ln(r,e,n)};Object.defineProperty(S,"__esModule",{value:!0});b(Ne(),S);b(F(),S);b(se(),S);b(vt(),S);b(pe(),S);b(Re(),S);b(bt(),S);b(At(),S);b(It(),S);b(Ke(),S);b(Kt(),S);b(Lt(),S);b(wt(),S);b(Ft(),S)});var _=[];for(let e=0;e<256;++e)_.push((e+256).toString(16).slice(1));function xt(e,r=0){return(_[e[r+0]]+_[e[r+1]]+_[e[r+2]]+_[e[r+3]]+"-"+_[e[r+4]]+_[e[r+5]]+"-"+_[e[r+6]]+_[e[r+7]]+"-"+_[e[r+8]]+_[e[r+9]]+"-"+_[e[r+10]]+_[e[r+11]]+_[e[r+12]]+_[e[r+13]]+_[e[r+14]]+_[e[r+15]]).toLowerCase()}var ke,Qr=new Uint8Array(16);function be(){if(!ke){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ke=crypto.getRandomValues.bind(crypto)}return ke(Qr)}var zr=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ae={randomUUID:zr};function jr(e,r,n){if(Ae.randomUUID&&!r&&!e)return Ae.randomUUID();e=e||{};let i=e.random??e.rng?.()??be();if(i.length<16)throw new Error("Random bytes length must be >= 16");if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,r){if(n=n||0,n<0||n+16>r.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let o=0;o<16;++o)r[n+o]=i[o];return r}return xt(i)}var N=jr;var Pe=J(H());var me=class e{data;constructor(r){this.data=r}unsafeExpectSuccess(){if(this.data.success)return this.data.data;throw new Error("Expected a non-error response from a Result!")}mapS(r){return this.data.success?new e({success:!0,data:r(this.data.data)}):this}mapE(r){return this.data.success?this:new e({success:!1,error:r(this.data.error)})}};function Fe(e){return new me({success:!0,data:e})}function Oe(e){return new me({success:!1,error:e})}var Gt=J(H());var Ot=["const","bool","float","int","uint","break","continue","do","else","for","if","discard","return","switch","case","default","bvec2","bvec3","bvec4","ivec2","ivec3","ivec4","uvec2","uvec3","uvec4","vec2","vec3","vec4","mat2","mat3","mat4","centroid","in","out","inout","uniform","flat","smooth","layout","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","sampler2d","sampler3d","samplercube","sampler2dshadow","samplercubeshadow","sampler2darray","sampler2darrayshadow","isampler2d","isampler3d","isamplercube","isampler2darray","usampler2d","usampler3d","usamplercube","usampler2darray","struct","void","while","invariant","highp","mediump","lowp","true","false","shared","packed","std140","row_major","column_major"],Mt=["*=","/=","%=","+=","-=","<<=",">>=","&=","^=","|=","++","--","==","!=",">=","<=","&&","||","^^","<<",">>","(",")","[","]","{","}",".",",",":","=",";","!","-","~","+","*","/","%","<",">","|","^","&","?"];var qt=(0,Gt.buildLexer)([[!0,new RegExp(Ot.map(e=>`^${e}`).join("|"),"g"),1],[!0,new RegExp(`^(${Mt.map(e=>e.split("").map(r=>`\\${r}`).join("")).join("|")})`,"g"),0],[!1,/^\s+/g,2],[!0,/^(\/\/[^\n]*\n)|^(\/\*[\s\S]*?\*\/)/g,3],[!0,/^[a-zA-Z_][a-zA-Z0-9_]*/g,4],[!0,/^[1-9][0-9]*[uU]?/g,5],[!0,/^0[0-7]*[uU]?/g,6],[!0,/^0[xX][0-9a-fA-F]+[uU]?/g,7],[!0,/^([0-9]+\.[0-9]*|\.[0-9]+)([eE][\+\-]?[0-9]+)?[fF]?/g,8],[!0,/^[0-9]+[eE][\+\-][0-9]+[fF]?/g,8],[!0,/^"[^"]*"/g,9]]);var t=J(H());var y=J(H());var u=(0,y.apply)((0,y.rep_sc)((0,y.tok)(3)),e=>e.map(r=>({comment:r.text})));function Te(e){return(0,y.seq)(u,e)}function m(e){return d(e,r=>r,r=>[])}function D(e){return(0,y.apply)(Te(e),([r,n],[i,o])=>({data:n,comments:[r],range:{start:i?.pos.index,end:o?.pos.index},_isNode:!0}))}function P(e){return(0,y.apply)(e,(r,[n,i])=>({data:r.data,comments:[...r.comments],range:{start:n?.pos.index,end:i?.pos.index},_isNode:!0}))}function d(e,r,n){return(0,y.apply)(Te(e),([i,o])=>({data:r(o),comments:[i,...n(o)]}))}function Bt(e,r,n){return(0,y.apply)(e,i=>({data:r(i),comments:[...n(i)]}))}function Me(e,r,n){return(0,y.apply)(Te(e),([i,o])=>{let s=r(o);return{data:s.data,comments:[i,...s.comments,...n(o)]}})}function X(e,r,n,i){return(0,y.apply)(Te(e),([o,s])=>{let p=r(s);return{data:n(p.data,s),comments:[o,...i(p.comments,s)]}})}function Qt(e,r,n){return(0,y.apply)(e,(i,[o,s])=>{let p=r(i),c=n(i,p.comments);return{...p,comments:c}})}function xe(e,r,n){let i=(o,s,p,c)=>{let[f,l]=n(o,s,p,c);return{data:f,comments:l,range:{start:p,end:c},_isNode:!0}};return(0,y.lrec_sc)((0,y.apply)((0,y.seq)(e,r),([o,s],[p,c])=>i(o,s,p?.pos.index,c?.pos.index)),(0,y.apply)(r,(o,[s,p])=>({data:o,start:s,end:p})),(o,s)=>i(o,s.data,o.range.start,s.end?.pos.index))}function R(e,r,n){return(0,y.lrec_sc)(e,(0,y.seq)(u,n,e),(i,o)=>({data:{type:"binary-op",op:o[1],left:i,right:o[2],_isExpr:!0},comments:[o[0]],range:{start:i.range.start,end:o[2].range.end},_isNode:!0}))}var T=J(H());function a(e){return(0,T.apply)((0,T.str)(e),r=>r.text)}function zt(e,r,n,i){return(0,T.alt_sc)(e,D((0,T.kleft)(i||(0,T.apply)((0,T.nil)(),()=>({type:"error",errorType:"expr",_isExpr:!0,_isError:!0,why:r})),n??(0,T.nil)())))}function jt(e,r,n,i){return(0,T.alt_sc)(e,D((0,T.kleft)(i||(0,T.apply)((0,T.nil)(),()=>({type:"error",errorType:"stmt",_isStmt:!0,_isError:!0,why:r})),n??(0,T.nil)())))}function ee(e){return{parse(r){let n=e.parse(r);return n.successful&&n.candidates[0].result.data.type==="error"?{successful:!1,error:{kind:"Error",pos:r?.pos,message:""}}:n}}}function Wt(e,r){return{parse(n){let i=e.parse(n),o=r.parse(n);if(!i.successful)return i;if(o.successful){let s=o.candidates[0].nextToken?.pos?.index??1/0,p=i.candidates[0].nextToken?.pos?.index??1/0;if(s>=p)return{successful:!1,error:{kind:"Error",message:"Matched failure check parser.",pos:n?.pos}}}return i}}}function ye(e,r){return(0,T.combine)((0,T.alt_sc)(e,r?{parse(n){let i=r.parse(n);return i.successful?{...i,candidates:i.candidates.map(o=>({firstToken:o.firstToken,nextToken:o.firstToken,result:!0}))}:{candidates:[{firstToken:n,nextToken:n,result:!1}],successful:!0,error:void 0}}}:(0,T.nil)()),n=>n?(0,T.nil)():{parse(i){return i?{successful:!0,candidates:[{firstToken:i,nextToken:i.next,result:!0}],error:void 0}:{successful:!0,candidates:[{firstToken:i,nextToken:i,result:!1}],error:void 0}}},n=>n?ye(e,r):(0,T.nil)())}function wn(e){throw new Error("TODO")}var Yt=(0,t.rule)(),re=(0,t.rule)(),$t=(0,t.rule)(),Jt=(0,t.rule)(),Un=(0,t.rule)(),Zt=(0,t.rule)(),ne=(0,t.rule)(),er=(0,t.rule)(),tr=(0,t.rule)(),tt=(0,t.rule)(),rr=(0,t.rule)(),ge=(0,t.rule)(),qi=(0,t.rule)(),Ge=(0,t.rule)(),qe=(0,t.rule)(),Be=(0,t.rule)(),Qe=(0,t.rule)(),ze=(0,t.rule)(),je=(0,t.rule)(),We=(0,t.rule)(),Ve=(0,t.rule)(),He=(0,t.rule)(),Xe=(0,t.rule)(),Se=(0,t.rule)(),rt=(0,t.rule)(),q=(0,t.rule)(),nr=(0,t.rule)(),I=(0,t.rule)(),B=(0,t.rule)(),nt=(0,t.rule)(),it=(0,t.rule)(),ir=(0,t.rule)(),or=(0,t.rule)(),ot=(0,t.rule)(),sr=(0,t.rule)(),Ye=(0,t.rule)(),ar=(0,t.rule)(),ur=(0,t.rule)(),pr=(0,t.rule)(),Bi=(0,t.rule)(),ve=(0,t.rule)(),cr=(0,t.rule)(),$e=(0,t.rule)(),dr=(0,t.rule)(),lr=(0,t.rule)(),Je=(0,t.rule)(),fr=(0,t.rule)(),ie=(0,t.rule)(),te=(0,t.rule)(),Y=(0,t.rule)(),st=(0,t.rule)(),mr=(0,t.rule)(),at=(0,t.rule)(),Tr=(0,t.rule)(),ut=(0,t.rule)(),xr=(0,t.rule)(),yr=(0,t.rule)(),Ze=(0,t.rule)(),Ee=(0,t.rule)(),pt=(0,t.rule)(),gr=(0,t.rule)(),et=(0,t.rule)(),_e=(0,t.rule)(),he=(0,t.rule)(),Sr=(0,t.rule)(),oe=(0,t.rule)(),ct=(0,t.rule)(),dt=(0,t.rule)(),Er=(0,t.rule)(),_r=(0,t.rule)(),lt=(0,t.rule)(),vr=(0,t.rule)(),hr=(0,t.rule)(),Pr=(0,t.rule)(),kr=(0,t.rule)(),br=(0,t.rule)(),Ar=(0,t.rule)(),Cr=(0,t.rule)(),Nr=(0,t.rule)(),ft=(0,t.rule)(),Rr=(0,t.rule)(),Ir=(0,t.rule)(),Qi=D((0,t.apply)((0,t.nil)(),()=>({type:"error",why:"Placeholder encountered during parsing!"})));Yt.setPattern(D((0,t.apply)((0,t.tok)(4),e=>({type:"ident",ident:e.text,_isExpr:!0}))));re.setPattern((0,t.alt_sc)(Yt,D((0,t.alt_sc)((0,t.apply)((0,t.alt_sc)((0,t.tok)(5),(0,t.tok)(6),(0,t.tok)(7)),e=>({type:"int",int:e.text[0]=="0"?parseInt(e.text,8):parseInt(e.text),asString:e.text,unsigned:e.text.endsWith("u")||e.text.endsWith("U"),_isExpr:!0})),(0,t.apply)((0,t.tok)(8),e=>({type:"float",float:parseFloat(e.text),asString:e.text,_isExpr:!0})),(0,t.apply)((0,t.alt_sc)((0,t.str)("true"),(0,t.str)("false")),e=>({type:"bool",bool:e.text=="true",_isExpr:!0})))),zt(Qt((0,t.seq)(u,(0,t.str)("("),I,u,(0,t.str)(")")),e=>e[2],(e,r)=>[e[0],...r,e[3]]),"Syntax error.",ye((0,t.str)(")")))));var Fn=xe((0,t.alt_sc)(ne,ee(re)),(0,t.apply)((0,t.seq)(u,(0,t.str)("."),u,(0,t.alt_sc)((0,t.apply)(ne,e=>({type:"function",function:e})),(0,t.apply)(m((0,t.apply)((0,t.tok)(4),e=>e.text)),e=>({type:"variable",variable:e})))),e=>e[3]),(e,r)=>[{type:"field-access",left:e,right:r,_isExpr:!0},[]]);$t.setPattern((0,t.alt_sc)(xe(ee(re),(0,t.seq)(u,(0,t.str)("["),Jt,u,(0,t.str)("]")),(e,r)=>[{left:e,right:r[2],type:"binary-op",op:"[]",_isExpr:!0},[r[0],r[3]]]),xe(ee(re),(0,t.seq)(u,(0,t.alt_sc)((0,t.str)("++"),(0,t.str)("--"))),(e,r)=>[{type:"unary-op",left:e,op:r[1].text,isAfter:!0,_isExpr:!0},[r[0]]]),Fn,ne,ee(re)));Jt.setPattern(I);Un.setPattern(Zt);Zt.setPattern(ne);ne.setPattern(P(Me((0,t.seq)((0,t.alt_sc)(tr,er),u,(0,t.str)(")")),e=>e[0],e=>[e[1]])));er.setPattern(X((0,t.seq)(tt,(0,t.opt_sc)((0,t.seq)(u,(0,t.str)("void")))),e=>e[0],(e,r)=>({type:"function-call",identifier:e,isVoid:r[1]!==void 0,args:[],_isExpr:!0}),(e,r)=>[...e,r[1]?.[0]??[]]));tr.setPattern(X((0,t.seq)(tt,q,(0,t.rep_sc)((0,t.seq)(u,(0,t.str)(","),q))),e=>e[0],(e,r)=>({type:"function-call",identifier:e,isVoid:!1,args:[r[1],...r[2].map(n=>n[2])],_isExpr:!0}),(e,r)=>[...e,...r[2].map(n=>n[0])]));tt.setPattern(Me((0,t.seq)(rr,u,(0,t.str)("(")),e=>e[0],e=>[e[1]]));rr.setPattern((0,t.alt_sc)(Y,m((0,t.apply)((0,t.tok)(4),e=>({type:"function-identifier",identifier:e.text})))));ge.setPattern((0,t.alt_sc)($t,D((0,t.apply)((0,t.seq)((0,t.alt_sc)((0,t.str)("--"),(0,t.str)("++"),(0,t.str)("+"),(0,t.str)("-"),(0,t.str)("!"),(0,t.str)("~")),ge),([e,r])=>({type:"unary-op",op:e.text,left:r,isAfter:!1,_isExpr:!0})))));Ge.setPattern(R(ge,Ge,(0,t.alt_sc)(a("*"),a("/"),a("%"))));qe.setPattern(R(Ge,qe,(0,t.alt_sc)(a("+"),a("-"))));Be.setPattern(R(qe,Be,(0,t.alt_sc)(a(">>"),a("<<"))));Qe.setPattern(R(Be,Qe,(0,t.alt_sc)(a(">"),a("<"),a(">="),a("<="))));ze.setPattern(R(Qe,ze,(0,t.alt_sc)(a("=="),a("!="))));je.setPattern(R(ze,je,a("&")));We.setPattern(R(je,We,a("^")));Ve.setPattern(R(We,Ve,a("|")));He.setPattern(R(Ve,He,a("&&")));Xe.setPattern(R(He,Xe,a("^^")));Se.setPattern(R(Xe,Se,a("||")));rt.setPattern((0,t.alt_sc)(P(d((0,t.seq)(Se,u,(0,t.str)("?"),I,u,(0,t.str)(":"),q),e=>({type:"conditional",condition:e[0],ifTrue:e[3],ifFalse:e[6],_isExpr:!0}),e=>[e[1],e[4]])),Se));q.setPattern((0,t.alt_sc)(P(d((0,t.seq)(ge,u,nr,q),e=>({type:"assignment",left:e[0],right:e[3],op:e[2],_isExpr:!0}),e=>[e[1]])),rt));nr.setPattern((0,t.alt_sc)(a("="),a("*="),a("/="),a("%="),a("+="),a("-="),a("<<="),a(">>="),a("&="),a("^="),a("|=")));I.setPattern(R(q,I,a(",")));B.setPattern(rt);nt.setPattern((0,t.alt_sc)(d((0,t.seq)(pr,u,(0,t.str)(";")),e=>({type:"declarator-list",declaratorList:e[0],_isDecl:!0}),e=>[e[1]]),d((0,t.seq)((0,t.apply)(ie,e=>e),m((0,t.apply)((0,t.tok)(4),e=>e.text)),u,(0,t.str)("{"),ut,u,(0,t.str)("}"),(0,t.opt_sc)((0,t.seq)(m((0,t.apply)((0,t.tok)(4),e=>e.text)),(0,t.opt_sc)((0,t.seq)(u,(0,t.str)("["),B,u,(0,t.str)("]"))))),u,(0,t.str)(";")),e=>({type:"struct",typeQualifier:e[0],name:e[1],name2:e[7]?.[0],declarationList:e[4],constantExpr:e[7]?.[1]?.[2],_isDecl:!0}),e=>[e[2],e[5],...e[7]?.[1]?[e[7][1][0],e[7][1][3]]:[],e[8]]),d((0,t.seq)(it,u,(0,t.str)(";")),e=>({type:"function-prototype",prototype:e[0],_isDecl:!0}),e=>[e[1]]),d((0,t.seq)((0,t.str)("precision"),at,st,u,(0,t.str)(";")),e=>({type:"type-specifier",precision:e[1],specifier:e[2],_isDecl:!0}),e=>[e[3]]),d((0,t.seq)(ie,u,(0,t.str)(";")),e=>({type:"type-qualifier",typeQualifier:e[0],_isDecl:!0}),e=>[e[1]])));it.setPattern(X((0,t.seq)(ir,u,(0,t.str)(")")),e=>e[0],e=>e,(e,r)=>[...e,r[1]]));ir.setPattern((0,t.alt_sc)(or,ot));or.setPattern(X((0,t.seq)(ot,d((0,t.seq)(Ye,(0,t.rep_sc)((0,t.seq)(u,(0,t.str)(","),Ye))),e=>[e[0],...e[1].map(r=>r[2])],e=>e[1].map(r=>r[0]))),e=>e[0],(e,r)=>({...e,parameters:r[1]}),e=>e));ot.setPattern(d((0,t.seq)(ve,m((0,t.apply)((0,t.tok)(4),e=>e.text)),u,(0,t.str)("(")),e=>({fullySpecifiedType:e[0],name:e[1]}),e=>[e[2]]));sr.setPattern(d((0,t.seq)(Y,m((0,t.apply)((0,t.tok)(4),e=>e.text)),(0,t.opt_sc)((0,t.seq)((0,t.str)("["),B,u,(0,t.str)("]")))),e=>({typeSpecifier:e[0],identifier:e[1],arraySize:e[2]?.[1]}),e=>[e[2]?.[2]??[]]));Ye.setPattern(m((0,t.apply)((0,t.seq)((0,t.opt_sc)(fr),ar,(0,t.alt_sc)((0,t.apply)(sr,e=>({type:"declarator",declarator:e})),(0,t.apply)(ur,e=>({type:"specifier",specifier:e})))),([e,r,n])=>({parameterTypeQualifier:e,parameterQualifier:r,declaratorOrSpecifier:n}))));ar.setPattern((0,t.alt_sc)(D((0,t.alt_sc)(a("in"),a("out"),a("inout"))),(0,t.nil)()));ur.setPattern(Y);var Vt=d((0,t.seq)(m((0,t.apply)((0,t.tok)(4),e=>e.text)),(0,t.alt_sc)(d((0,t.seq)((0,t.str)("["),B,u,(0,t.str)("]")),e=>({type:"sized-array",size:e[1]}),e=>[e[2]]),d((0,t.seq)((0,t.str)("["),(0,t.opt_sc)(B),u,(0,t.str)("]"),u,(0,t.str)("="),Ee),e=>({type:"initialized-array",size:e[1],initializer:e[6]}),e=>[e[2],e[4]]),d((0,t.seq)(u,(0,t.str)("="),Ee),e=>({type:"initialized",initializer:e[2]}),e=>[e[0]]),(0,t.nil)())),e=>({name:e[0],variant:e[1]}),e=>[]);pr.setPattern(m((0,t.apply)((0,t.seq)((0,t.alt_sc)(m((0,t.apply)(ve,e=>({type:"type",declType:e}))),m((0,t.apply)((0,t.str)("invariant"),e=>({type:"invariant"})))),d((0,t.opt_sc)((0,t.seq)(Vt,(0,t.rep_sc)((0,t.seq)(u,(0,t.str)(","),Vt)))),e=>e?[e[0],...e[1].map(r=>r[2])]:[],e=>e?e[1].map(r=>r[0]):[])),e=>({init:e[0],declarations:e[1]}))));ve.setPattern(m((0,t.apply)((0,t.seq)((0,t.opt_sc)(ie),Y),([e,r])=>({specifier:r,qualifier:e}))));cr.setPattern(m(a("invariant")));$e.setPattern(m((0,t.alt_sc)(a("smooth"),a("flat"))));dr.setPattern(X((0,t.seq)((0,t.str)("layout"),u,(0,t.str)("("),lr,u,(0,t.str)(")")),e=>e[3],(e,r)=>e,(e,r)=>[r[1],...e,r[4]]));lr.setPattern(d((0,t.seq)(Je,(0,t.rep_sc)((0,t.seq)(u,a(","),Je))),e=>[e[0],...e[1].map(r=>r[2])],e=>e[1].map(r=>r[0])));Je.setPattern((0,t.alt_sc)(d((0,t.seq)((0,t.tok)(4),u,(0,t.str)("="),u,(0,t.alt_sc)((0,t.tok)(5),(0,t.tok)(7),(0,t.tok)(6))),e=>({identifier:e[0].text,value:wn(e[4].text)}),e=>[e[1],e[3]]),m((0,t.apply)((0,t.alt_sc)((0,t.tok)(4),(0,t.tok)(1)),e=>({identifier:e.text})))));fr.setPattern(m(a("const")));ie.setPattern((0,t.alt_sc)(m((0,t.apply)(te,e=>({type:"sq",storageQualifier:e}))),m((0,t.apply)((0,t.seq)(dr,(0,t.opt_sc)(te)),([e,r])=>({type:"lq-sq",layoutQualifier:e,storageQualifier:r}))),m((0,t.apply)((0,t.seq)($e,(0,t.opt_sc)(te)),([e,r])=>({type:"intq-sq",interpolationQualifier:e,storageQualifier:r}))),m((0,t.apply)((0,t.seq)(cr,(0,t.opt_sc)($e),te),([e,r,n])=>({type:"invq-intq-sq",interpolationQualifier:r,invariantQualifier:e,storageQualifier:n})))));te.setPattern(m((0,t.alt_sc)(a("const"),a("in"),a("out"),(0,t.apply)((0,t.seq)((0,t.str)("centroid"),(0,t.str)("in")),()=>"centroid in"),(0,t.apply)((0,t.seq)((0,t.str)("centroid"),(0,t.str)("out")),()=>"centroid out"),a("uniform"))));Y.setPattern(d((0,t.seq)((0,t.opt_sc)(at),st),([e,r])=>({type:"type-specifier",specifier:r,precision:e}),e=>[]));st.setPattern(d((0,t.seq)(mr,(0,t.opt_sc)((0,t.seq)(u,(0,t.seq)((0,t.str)("["),(0,t.opt_sc)(B),u,(0,t.str)("]"))))),e=>({typeName:e[0],arrayType:e[1]?e[1][1][1]?{type:"static",size:e[1][1][1]}:{type:"dynamic"}:{type:"none"}}),e=>e[1]?[e[1][0],e[1][1][2]]:[]));mr.setPattern(m((0,t.alt_sc)((0,t.apply)(m((0,t.alt_sc)((0,t.alt_sc)(a("void"),a("float"),a("int"),a("uint"),a("bool"),a("vec2"),a("vec3"),a("vec4"),a("bvec2"),a("bvec3"),a("bvec4"),a("ivec2"),a("ivec3"),a("ivec4"),a("uvec2"),a("uvec3")),(0,t.alt_sc)(a("uvec4"),a("mat2"),a("mat3"),a("mat4"),a("mat3x2"),a("mat3x3"),a("mat3x4"),a("mat4x2"),a("mat4x3"),a("mat4x4")),(0,t.alt_sc)(a("sampler2D"),a("sampler3D"),a("samplerCube"),a("sampler2DShadow"),a("samplerCubeShadow"),a("sampler2DArray"),a("sampler2DArrayShadow"),a("isampler2D"),a("isampler3D"),a("isamplerCube"),a("isampler2DArray"),a("usampler2D"),a("usampler3D"),a("usamplerCube"),a("usampler2DArray")))),e=>({type:"builtin",name:e})),(0,t.apply)(Tr,e=>({type:"struct",struct:e})),(0,t.apply)(m((0,t.apply)((0,t.tok)(4),e=>e.text)),e=>({type:"custom",name:e})))));at.setPattern(m((0,t.alt_sc)(a("highp"),a("mediump"),a("lowp"))));Tr.setPattern(d((0,t.seq)((0,t.str)("struct"),(0,t.opt_sc)(m((0,t.apply)((0,t.tok)(4),e=>e.text))),u,(0,t.str)("{"),ut,u,(0,t.str)("}")),e=>({members:e[4],name:e[1],_isStruct:!0}),e=>[e[2],e[5]]));ut.setPattern(m((0,t.rep_sc)(xr)));xr.setPattern(d((0,t.seq)((0,t.opt_sc)(ie),Y,yr,u,(0,t.str)(";")),e=>({typeQualifier:e[0],typeSpecifier:e[1],declaratorList:e[2]}),e=>[e[3]]));yr.setPattern(d((0,t.seq)(Ze,(0,t.rep_sc)((0,t.seq)(u,(0,t.str)(","),Ze))),e=>[e[0],...e[1].map(r=>r[2])],e=>e[1].map(r=>r[0])));Ze.setPattern(d((0,t.seq)((0,t.tok)(4),(0,t.opt_sc)((0,t.seq)(u,(0,t.str)("["),(0,t.opt_sc)(B),u,(0,t.str)("]")))),e=>({name:e[0].text,isArray:e[1]?{expr:e[1]?.[2]}:void 0}),e=>e[1]?[e[1][0],e[1][3]]:[]));Ee.setPattern(q);pt.setPattern(D((0,t.apply)(nt,e=>({type:"declaration",decl:e,_isStmt:!0}))));gr.setPattern((0,t.alt_sc)(Sr,he));et.setPattern((0,t.alt_sc)(oe,he));_e.setPattern((0,t.alt_sc)(oe,he));he.setPattern((0,t.alt_sc)(dt,pt,Er,vr,Pr,kr,Nr));Sr.setPattern(oe);oe.setPattern(P(d((0,t.seq)((0,t.str)("{"),(0,t.opt_sc)(ct),u,(0,t.str)("}")),e=>({type:"compound",statements:e[1]??[],_isStmt:!0}),e=>[e[2]])));var Ht=Wt(jt(gr,"Expected a statement.",ye((0,t.str)(";"),(0,t.str)("}"))),(0,t.rep_sc)((0,t.alt_sc)((0,t.tok)(2),(0,t.tok)(3))));ct.setPattern((0,t.apply)((0,t.seq)(Ht,(0,t.rep_sc)(Ht)),([e,r])=>[e,...r]));dt.setPattern(P(d((0,t.seq)((0,t.opt_sc)(I),u,(0,t.str)(";")),e=>({type:"expr",expr:e[0],_isStmt:!0}),e=>[e[1]])));Er.setPattern(P(d((0,t.seq)((0,t.str)("if"),u,(0,t.str)("("),I,u,(0,t.str)(")"),_r),e=>({type:"selection",cond:e[3],rest:e[6],_isStmt:!0}),e=>[e[1],e[4]])));_r.setPattern(d((0,t.seq)(_e,(0,t.opt_sc)((0,t.seq)(u,(0,t.str)("else"),_e))),e=>({if:e[0],else:e[1]?.[2],_isStmt:!0}),e=>e[1]?[e[1][0]]:[]));lt.setPattern((0,t.alt_sc)(m((0,t.apply)(I,e=>({type:"expr",expr:e}))),d((0,t.seq)(ve,m((0,t.apply)((0,t.tok)(4),e=>e.text)),u,(0,t.str)("="),Ee),e=>({type:"type-equal-init",fullySpecifiedType:e[0],name:e[1],initializer:e[4]}),e=>[e[2]])));vr.setPattern(P(d((0,t.seq)((0,t.str)("switch"),u,(0,t.str)("("),I,u,(0,t.str)(")"),u,(0,t.str)("{"),hr,u,(0,t.str)("}")),e=>({type:"switch",expr:e[3],stmts:e[8]??[],_isStmt:!0}),e=>[e[1],e[4],e[6],e[9]])));hr.setPattern((0,t.opt_sc)(ct));Pr.setPattern(P((0,t.alt_sc)(d((0,t.seq)((0,t.str)("case"),I,u,(0,t.str)(":")),e=>({type:"case",expr:e[1],_isStmt:!0}),e=>[e[2]]),d((0,t.seq)((0,t.str)("default"),u,(0,t.str)(":")),e=>({type:"default-case",_isStmt:!0}),e=>[e[1]]))));kr.setPattern(P((0,t.alt_sc)(d((0,t.seq)((0,t.str)("while"),u,(0,t.str)("("),lt,u,(0,t.str)(")"),et),e=>({type:"while",cond:e[3],body:e[6],_isStmt:!0}),e=>[e[1],e[4]]),d((0,t.seq)((0,t.str)("do"),_e,u,(0,t.str)("while"),u,(0,t.str)("("),I,u,(0,t.str)(")"),u,(0,t.str)(";")),e=>({type:"do-while",cond:e[6],body:e[1],_isStmt:!0}),e=>[e[2],e[4],e[7],e[9]]),d((0,t.seq)((0,t.str)("for"),u,(0,t.str)("("),br,Cr,u,(0,t.str)(")"),et),e=>({type:"for",init:e[3],rest:e[4],body:e[7],_isStmt:!0}),e=>[e[1],e[5]]))));br.setPattern((0,t.alt_sc)(dt,pt));Ar.setPattern((0,t.alt_sc)(lt,(0,t.nil)()));Cr.setPattern(d((0,t.seq)(Ar,u,(0,t.str)(";"),(0,t.opt_sc)(I)),e=>({condition:e[0],expr:e[3]}),e=>[e[1]]));Nr.setPattern(P((0,t.alt_sc)(d((0,t.seq)((0,t.alt_sc)(a("continue"),a("break"),a("discard")),u,(0,t.str)(";")),e=>({type:e[0],_isStmt:!0}),e=>[e[1]]),d((0,t.seq)((0,t.str)("return"),(0,t.opt_sc)(I),u,(0,t.str)(";")),e=>({type:"return",expr:e[1],_isStmt:!0}),e=>[e[2]]))));ft.setPattern(P(Bt((0,t.seq)((0,t.rep_sc)(Rr),u),e=>e[0],e=>[e[1]])));var Xt=P(d((0,t.seq)((0,t.tok)(4),(0,t.opt_sc)((0,t.seq)(u,(0,t.str)("as"),u,(0,t.tok)(4)))),e=>({name:e[0].text,alias:e[1]?.[3].text}),e=>e[1]?[e[1][0],e[1][2]]:[])),On=P(d((0,t.seq)((0,t.str)("import"),u,(0,t.alt_sc)(d((0,t.seq)((0,t.str)("*"),(0,t.opt_sc)((0,t.seq)(u,(0,t.str)("as"),u,(0,t.tok)(4)))),e=>({type:"all",prefix:e[1]?.[3]?.text??""}),e=>e[1]?[e[1][0],e[1][2]]:[]),d((0,t.seq)((0,t.str)("{"),(0,t.opt_sc)((0,t.seq)(Xt,(0,t.rep_sc)((0,t.seq)(u,(0,t.str)(","),Xt)))),u,(0,t.str)("}")),e=>({type:"some",imports:e[1]?[e[1][0],...e[1][1].map(r=>r[2])??[]]:[]}),e=>[...e[1]?.[1].map(r=>r[0])??[],e[2]])),u,(0,t.str)("from"),u,(0,t.tok)(9),u,(0,t.str)(";")),e=>({type:"import",imports:e[2],from:e[6].text.slice(1,-1)}),e=>[e[1],e[5],e[7]]));Rr.setPattern((0,t.alt_sc)(On,Ir,D((0,t.apply)(nt,e=>({type:"declaration",decl:e,_isExtDecl:!0})))));Ir.setPattern(P(d((0,t.seq)(it,oe),e=>({type:"function",prototype:e[0],body:e[1],_isExtDecl:!0}),e=>[])));function Mn(e){let r=qt.parse(e);return Fe(r)}function Kr(e){let r=Mn(e);if(!r.data.success)return Oe(r.data.error);try{let n=(0,Pe.expectSingleResult)((0,Pe.expectEOF)(ft.parse(r.data.data)));return Fe({translationUnit:n})}catch(n){return Oe({why:(n??"").toString()})}}function L(e,r){return{count:e,type:r}}function Lr(e){return{float:L(1,"float"),vec2:L(2,"float"),vec3:L(3,"float"),vec4:L(4,"float"),int:L(1,"int"),ivec2:L(2,"int"),ivec3:L(3,"int"),ivec4:L(4,"int"),uint:L(1,"uint"),uvec2:L(2,"uint"),uvec3:L(3,"uint"),uvec4:L(4,"uint")}[e]}function Dr(e){let r={},n={},i={};for(let o of e.data)if(o.data.type==="declaration"){let s=o.data.decl.data;if(s.type==="declarator-list"){let p=s.declaratorList.data.init.data;if(p.type==="type"){let c=p.declType.data.qualifier?.data,f=p.declType.data.specifier.data.specifier.data.typeName.data,l;if(f.type==="builtin"){let E=f.name.data;l=Lr(E),l||(l={type:"sampler",dimensionality:"2D",samplerType:"float"})}if(c&&l){let E=c.storageQualifier?.data==="uniform",g=c.storageQualifier?.data?.endsWith("in"),A=c.storageQualifier?.data?.endsWith("out");for(let v of s.declaratorList.data.declarations.data){let C=v.data.name.data;E?r[C]=l:g&&l.type!=="sampler"?n[C]=l:A&&l.type!=="sampler"&&(i[C]=l)}}}}}return{uniforms:r,inputs:n,outputs:i}}function wr(e){return{clear(r,n,i){return e({contents:{type:"clear",color:r,depth:n,stencil:i},id:N()})},async createBufferFromArray(r){let{count:n,encoding:i,size:o,array:s}=r;return(await e({id:N(),contents:{type:"create-buffer",id:N(),source:{type:"array",spec:[{count:n,encoding:i,size:o,value:s,name:"attr",stride:0,offset:0}]}}})).content},async linkProgram(r,n){return(await e({id:N(),contents:{type:"create-program",id:N(),vertex:r,fragment:n}})).content},sendGLMessage(r){return e(r)},async draw(r,n,i,o,s){return e({id:N(),contents:{type:"draw",program:r,inputs:i,outputs:o,uniforms:s,count:n}})},async create8BitRGBATexture(r,n,i){return(await e({id:N(),contents:{type:"create-texture",pixels:r,width:n,height:i,internalformat:WebGL2RenderingContext.RGBA8,minFilter:WebGL2RenderingContext.LINEAR,magFilter:WebGL2RenderingContext.LINEAR,wrapS:WebGL2RenderingContext.REPEAT,wrapT:WebGL2RenderingContext.REPEAT,id:N()}})).content},async loadShader(r,n){let i=await e({id:N(),contents:{type:"load-file",path:r}});if(!i.content.file)return;let o=await i.content.file.text(),s=o.replace(/^.*\#version 300 es/,""),p=Kr(s);if(!p.data.success)return;let c=p.data.data.translationUnit;return(await e({id:N(),contents:{type:"create-shader",source:{shaderType:n,text:o,...Dr(c)},id:N()}})).content}}}var Gn=wr(e=>new Promise((r,n)=>{window.addEventListener("message",i=>{i.data?.id===e.id&&r(i.data)}),window.parent.postMessage(e,"*")}));for(let[e,r]of Object.entries(Gn))window[e]=r;})();
//# sourceMappingURL=EvalboxGLWrapper.js.map
